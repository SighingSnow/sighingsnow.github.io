---
layout: post
toc: true
title: "Delaunay triangulation"
categories: Graphics
tags: [delaunay]
author: Tingyu Song 
---

### FLIP

1. Do FLIP operation according to the vertex pos. We have flip13, flip22, flip24, flip42 and so on.
2. Then we need to get the vertices which are infected. And then push the infected edges into it. For FLIP13 and FLIP24, we not only add the origin triangle edge also the newly created 3 edges.

### FLIP13

This situation happen's when the vertex to be inserted is in triangle or outside the triangle.

1. Find the neighbors of triangle which the edge is on.

2. Counstruct new 3 triangles.

   ![image-20210903120318607](/assets/detri2/flip13.png)

3. Connect the newly constructed triangles with the neighbors found previously.

4. After that, set the hull tag？ I don't know much about it. 

### Lawson Flip

Lawson flip is to make some cases which is not a Delaunay triangulation to a Delaunay triangulation.

Below picture refers from [ti.inf.ethz.ch/ew/CG13/lecture](https://www.ti.inf.ethz.ch/ew/Lehre/CG13/lecture/Chapter 6.pdf). So what the lawson's flip do in the below picture is to turn (b)  to (a) in order to satisfy the constraints of Delaunay triangulation.

![](/assets/detri2/lawson.png)

Below notes are not ordered yet. 

### Detri2 

1. What's the segment here ?
2. a inf vertex
3. what is hull triangle

process is below

```c++
initialize(){
  // init vertex and segment
  // a infvertex
  initialize_lookup_table(); // init the bitmasks
  reset_options();
}
```

```c++
Triangulation tr = new Triangulation();
tr->parse_commands(argc,argv);
tr->read_mesh();
tr->reconstruct_mesh(0);
```



初始化用于精确计算的变量，里面的参数完全不知道意思，应该也不重要。

sort_vertices(Vertex* vrtarray, int arysize, Vertex** & permutarray) 对于顶点进行随机排序，在Debug时候给进去的顶点未经过排序，进入下一个函数brio_multiscale_sort2，里面的so_brio_threshold其实不太理解。说明里是这样说的“Sort the points using BRIO and Hilbert curve. ” okay等会去看一下 Hilbert curve.

排序之后开始插点，如果三角形为空，就从里面拿3个出来。之后还需要新建三个假的邻接三角形。接下来开始插点，插点首先要确定点的位置。进入locate_point，根据点位返回不同的结果，有在三角形里，在边上，在点上有点不理解。得到如果为逆时针，就变成顺时针。做flip操作，每一种情况都有对应的lawson flip。flip之后进行lawson flip。lawson flip实际上是说，需要递归的去翻转点边。

```c++
void exactinit(int verbose, int noexact, int o3dfilter, int ispfilter, REAL maxx, REAL maxy, REAL maxz)
int Triangulation::sort_vertices(Vertex* vrtarray, int arysize, Vertex**& permutarray)
  void brio_multiscale_sort2(permutarray, arysize, so_brio_threshold,
                          so_brio_ratio, so_hilbert_order, so_hilbert_limit,
                          io_xmin, io_xmax, io_ymin, io_ymax);
```

一些奇怪的常量 -V

```c++
op_db_verbose 这个意思是把每一步打印出来，有点类似于黑苹果安装的-v选项
```

重要的类

```c++
class Triangulation{
  public:
  arraypool* tr_steiners; // Stenier vertices 狭窄的顶点？？？
  arraypool* tr_segs;
  arraypool* tr_tris; // exm这又是啥
}
```

1. Locate_point 三角形

   当没有三角形时从0构建1个。并且确定是顺时针还是逆时针。里面判断hull triangle。

2. Flip13 遍历三角形的所有边，拿到邻接的所有三角形。

### 笔记

1. Orient2D是一个线性规划，解一个不等式
2. 使用exactinit的原因可以在 [triangle_exact](http://www.cs.cmu.edu/~quake/triangle.exact.html)
3. 这些名词解释很有用[definition](http://www.cs.cmu.edu/~quake/triangle.defs.html)

### 问题

1. 在初始化Triangulation时，初始化了一个tr_infvrt，这个tr_infvrt是什么。
2. 在放点的时候，要找到一个说组成的三角形位置是逆时针的，但这个edge为什么可以表示为3个点。
3. locate_point没看懂。看懂了，是个线性规划。
4. 为什么需要维护一个内存池子，懂了因为这个池子里是需要翻转的边。
5. Delaunay 45 行，
6. 这个locate point是不是有点类似于正弦定理，乘出来小于0就怎样，大于0就怎样。如果这个点在三角形里，他需要满足和其中的两个三角形为逆时针。
7. 为什么需要 _vo , _vd, _va这三个数组。
8. TriEdge里的 apex(), org(), dest() 的原型是什么，org->origin, dest->destination,可是为什么是个函数。
9. PSLG的定义还不太理解“*Segments* are edges whose endpoints are vertices in the PSLG, and whose presence in any mesh generated from the PSLG is enforced.” 以及**CCDT**，**CDT**
10. is_hulltriangle()
11. what's flip ? 
12. Set_edge_infected 一个位操作
13. hull flag

